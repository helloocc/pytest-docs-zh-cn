
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Doctest integration for modules and test files &#8212; pytest documentation</title>
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments_pytest.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="shortcut icon" href="_static/pytest1favi.ico"/>
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Skip and xfail: dealing with tests that cannot succeed" href="skipping.html" />
    <link rel="prev" title="Warnings Capture" href="warnings.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head><body>
  
  
  


    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="skipping.html" title="Skip and xfail: dealing with tests that cannot succeed"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="warnings.html" title="Warnings Capture"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="contents.html">pytest-5.0</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="doctest-integration-for-modules-and-test-files">
<h1>Doctest integration for modules and test files<a class="headerlink" href="#doctest-integration-for-modules-and-test-files" title="Permalink to this headline">¶</a></h1>
<p>By default all files matching the <code class="docutils literal notranslate"><span class="pre">test*.txt</span></code> pattern will
be run through the python standard <code class="docutils literal notranslate"><span class="pre">doctest</span></code> module.  You
can change the pattern by issuing:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest --doctest-glob<span class="o">=</span><span class="s1">&#39;*.rst&#39;</span>
</pre></div>
</div>
<p>on the command line. <code class="docutils literal notranslate"><span class="pre">--doctest-glob</span></code> can be given multiple times in the command-line.</p>
<p>If you then have a text file like this:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># content of test_example.txt

hello this is a doctest
&gt;&gt;&gt; x = 3
&gt;&gt;&gt; x
3
</pre></div>
</div>
<p>then you can just invoke <code class="docutils literal notranslate"><span class="pre">pytest</span></code> directly:</p>
<div class="highlight-pytest notranslate"><div class="highlight"><pre><span></span>$ pytest
<span class=" -Color -Color-Bold">=========================== test session starts ============================</span>
platform linux -- Python 3.x.y, pytest-5.x.y, py-1.x.y, pluggy-0.x.y
cachedir: $PYTHON_PREFIX/.pytest_cache
rootdir: $REGENDOC_TMPDIR
collected 1 item

test_example.txt <span class=" -Color -Color-Green">.</span>                                                   <span class=" -Color -Color-Cyan">[100%]</span>

<span class=" -Color -Color-BoldGreen">========================= 1 passed in 0.12 seconds =========================</span>
</pre></div>
</div>
<p>By default, pytest will collect <code class="docutils literal notranslate"><span class="pre">test*.txt</span></code> files looking for doctest directives, but you
can pass additional globs using the <code class="docutils literal notranslate"><span class="pre">--doctest-glob</span></code> option (multi-allowed).</p>
<p>In addition to text files, you can also execute doctests directly from docstrings of your classes
and functions, including from test modules:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of mymodule.py</span>
<span class="k">def</span> <span class="nf">something</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; a doctest in a docstring</span>
<span class="sd">    &gt;&gt;&gt; something()</span>
<span class="sd">    42</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">42</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest --doctest-modules
<span class="o">===========================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">============================</span>
platform linux -- Python <span class="m">3</span>.x.y, pytest-5.x.y, py-1.x.y, pluggy-0.x.y
cachedir: <span class="nv">$PYTHON_PREFIX</span>/.pytest_cache
rootdir: <span class="nv">$REGENDOC_TMPDIR</span>
collected <span class="m">2</span> items

mymodule.py .                                                        <span class="o">[</span> <span class="m">50</span>%<span class="o">]</span>
test_example.txt .                                                   <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">=========================</span> <span class="m">2</span> passed in <span class="m">0</span>.12 <span class="nv">seconds</span> <span class="o">=========================</span>
</pre></div>
</div>
<p>You can make these changes permanent in your project by
putting them into a pytest.ini file like this:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">addopts</span> <span class="o">=</span> <span class="s">--doctest-modules</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The builtin pytest doctest supports only <code class="docutils literal notranslate"><span class="pre">doctest</span></code> blocks, but if you are looking
for more advanced checking over <em>all</em> your documentation,
including doctests, <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">codeblock::</span> <span class="pre">python</span></code> Sphinx directive support,
and any other examples your documentation may include, you may wish to
consider <a class="reference external" href="https://sybil.readthedocs.io/en/latest/index.html">Sybil</a>.
It provides pytest integration out of the box.</p>
</div>
<div class="section" id="encoding">
<h2>Encoding<a class="headerlink" href="#encoding" title="Permalink to this headline">¶</a></h2>
<p>The default encoding is <strong>UTF-8</strong>, but you can specify the encoding
that will be used for those doctest files using the
<code class="docutils literal notranslate"><span class="pre">doctest_encoding</span></code> ini option:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of pytest.ini</span>
<span class="k">[pytest]</span>
<span class="na">doctest_encoding</span> <span class="o">=</span> <span class="s">latin1</span>
</pre></div>
</div>
</div>
<div class="section" id="using-doctest-options">
<h2>Using ‘doctest’ options<a class="headerlink" href="#using-doctest-options" title="Permalink to this headline">¶</a></h2>
<p>The standard <code class="docutils literal notranslate"><span class="pre">doctest</span></code> module provides some <a class="reference external" href="https://docs.python.org/3/library/doctest.html#option-flags">options</a>
to configure the strictness of doctest tests. In pytest, you can enable those flags using the
configuration file.</p>
<p>For example, to make pytest ignore trailing whitespaces and ignore
lengthy exception stack traces you can just write:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[pytest]</span>
<span class="na">doctest_optionflags</span><span class="o">=</span> <span class="s">NORMALIZE_WHITESPACE IGNORE_EXCEPTION_DETAIL</span>
</pre></div>
</div>
<p>pytest also introduces new options to allow doctests to run in Python 2 and
Python 3 unchanged:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ALLOW_UNICODE</span></code>: when enabled, the <code class="docutils literal notranslate"><span class="pre">u</span></code> prefix is stripped from unicode
strings in expected doctest output.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ALLOW_BYTES</span></code>: when enabled, the <code class="docutils literal notranslate"><span class="pre">b</span></code> prefix is stripped from byte strings
in expected doctest output.</p></li>
</ul>
<p>Alternatively, options can be enabled by an inline comment in the doc test
itself:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span># content of example.rst
&gt;&gt;&gt; get_unicode_greeting()  # doctest: +ALLOW_UNICODE
&#39;Hello&#39;
</pre></div>
</div>
<p>By default, pytest would report only the first failure for a given doctest. If
you want to continue the test even when you have failures, do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest --doctest-modules --doctest-continue-on-failure
</pre></div>
</div>
</div>
<div class="section" id="output-format">
<h2>Output format<a class="headerlink" href="#output-format" title="Permalink to this headline">¶</a></h2>
<p>You can change the diff output format on failure for your doctests
by using one of standard doctest modules format in options
(see <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_UDIFF" title="(in Python v3.7)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_UDIFF</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_CDIFF" title="(in Python v3.7)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_CDIFF</span></code></a>,
<a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_NDIFF" title="(in Python v3.7)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_NDIFF</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/doctest.html#doctest.REPORT_ONLY_FIRST_FAILURE" title="(in Python v3.7)"><code class="docutils literal notranslate"><span class="pre">doctest.REPORT_ONLY_FIRST_FAILURE</span></code></a>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest --doctest-modules --doctest-report none
pytest --doctest-modules --doctest-report udiff
pytest --doctest-modules --doctest-report cdiff
pytest --doctest-modules --doctest-report ndiff
pytest --doctest-modules --doctest-report only_first_failure
</pre></div>
</div>
</div>
<div class="section" id="pytest-specific-features">
<h2>pytest-specific features<a class="headerlink" href="#pytest-specific-features" title="Permalink to this headline">¶</a></h2>
<p>Some features are provided to make writing doctests easier or with better integration with
your existing test suite. Keep in mind however that by using those features you will make
your doctests incompatible with the standard <code class="docutils literal notranslate"><span class="pre">doctests</span></code> module.</p>
<div class="section" id="using-fixtures">
<h3>Using fixtures<a class="headerlink" href="#using-fixtures" title="Permalink to this headline">¶</a></h3>
<p>It is possible to use fixtures using the <code class="docutils literal notranslate"><span class="pre">getfixture</span></code> helper:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># content of example.rst
&gt;&gt;&gt; tmp = getfixture(&#39;tmpdir&#39;)
&gt;&gt;&gt; ...
&gt;&gt;&gt;
</pre></div>
</div>
<p>Also, <a class="reference internal" href="fixture.html#usefixtures"><span class="std std-ref">Using fixtures from classes, modules or projects</span></a> and <a class="reference internal" href="fixture.html#autouse"><span class="std std-ref">Autouse fixtures (xUnit setup on steroids)</span></a> fixtures are supported
when executing text doctest files.</p>
</div>
<div class="section" id="doctest-namespace-fixture">
<span id="doctest-namespace"></span><h3>‘doctest_namespace’ fixture<a class="headerlink" href="#doctest-namespace-fixture" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">doctest_namespace</span></code> fixture can be used to inject items into the
namespace in which your doctests run. It is intended to be used within
your own fixtures to provide the tests that use them with context.</p>
<p><code class="docutils literal notranslate"><span class="pre">doctest_namespace</span></code> is a standard <code class="docutils literal notranslate"><span class="pre">dict</span></code> object into which you
place the objects you want to appear in the doctest namespace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of conftest.py</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span><span class="p">(</span><span class="n">autouse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_np</span><span class="p">(</span><span class="n">doctest_namespace</span><span class="p">):</span>
    <span class="n">doctest_namespace</span><span class="p">[</span><span class="s1">&#39;np&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span>
</pre></div>
</div>
<p>which can then be used in your doctests directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># content of numpy.py</span>
<span class="k">def</span> <span class="nf">arange</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &gt;&gt;&gt; a = np.arange(10)</span>
<span class="sd">    &gt;&gt;&gt; len(a)</span>
<span class="sd">    10</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Note that like the normal <code class="docutils literal notranslate"><span class="pre">conftest.py</span></code>, the fixtures are discovered in the directory tree conftest is in.
Meaning that if you put your doctest with your source code, the relevant conftest.py needs to be in the same directory tree.
Fixtures will not be discovered in a sibling directory tree!</p>
</div>
<div class="section" id="skipping-tests-dynamically">
<h3>Skipping tests dynamically<a class="headerlink" href="#skipping-tests-dynamically" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified added">New in version 4.4.</span></p>
</div>
<p>You can use <code class="docutils literal notranslate"><span class="pre">pytest.skip</span></code> to dynamically skip doctests. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">pytest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;win&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">pytest</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="s1">&#39;this doctest does not work on Windows&#39;</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="contents.html">
              <img class="logo" src="_static/pytest1.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel"
        placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
  </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3><a href="contents.html">Table Of Contents</a></h3>

<ul>
  <li><a href="index.html">Home</a></li>
  <li><a href="getting-started.html">Install</a></li>
  <li><a href="contents.html">Contents</a></li>
  <li><a href="reference.html">API Reference</a></li>
  <li><a href="example/index.html">Examples</a></li>
  <li><a href="customize.html">Customize</a></li>
  <li><a href="changelog.html">Changelog</a></li>
  <li><a href="contributing.html">Contributing</a></li>
  <li><a href="backwards-compatibility.html">Backwards Compatibility</a></li>
  <li><a href="py27-py34-deprecation.html">Python 2.7 and 3.4 Support</a></li>
  <li><a href="sponsor.html">Sponsor</a></li>
  <li><a href="license.html">License</a></li>
  <li><a href="contact.html">Contact Channels</a></li>
</ul>
  <hr>
  <ul>
<li><a class="reference internal" href="#">Doctest integration for modules and test files</a><ul>
<li><a class="reference internal" href="#encoding">Encoding</a></li>
<li><a class="reference internal" href="#using-doctest-options">Using ‘doctest’ options</a></li>
<li><a class="reference internal" href="#output-format">Output format</a></li>
<li><a class="reference internal" href="#pytest-specific-features">pytest-specific features</a><ul>
<li><a class="reference internal" href="#using-fixtures">Using fixtures</a></li>
<li><a class="reference internal" href="#doctest-namespace-fixture">‘doctest_namespace’ fixture</a></li>
<li><a class="reference internal" href="#skipping-tests-dynamically">Skipping tests dynamically</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="contents.html">Documentation overview</a><ul>
      <li>Previous: <a href="warnings.html" title="previous chapter">Warnings Capture</a></li>
      <li>Next: <a href="skipping.html" title="next chapter">Skip and xfail: dealing with tests that cannot succeed</a></li>
  </ul></li>
</ul><h3>Useful Links</h3>
<ul>
  <li><a href="https://pypi.org/project/pytest/">pytest @ PyPI</a></li>
  <li><a href="https://github.com/pytest-dev/pytest/">pytest @ GitHub</a></li>
  <li><a href="http://plugincompat.herokuapp.com/">3rd party plugins</a></li>
  <li><a href="https://github.com/pytest-dev/pytest/issues">Issue Tracker</a></li>
  <li><a href="https://media.readthedocs.org/pdf/pytest/latest/pytest.pdf">PDF Documentation</a>
</ul>
        </div>
      </div>
      <div class="clearer"></div>
    </div>

  <div class="footer">
    &copy; Copyright 2015–2019, holger krekel and pytest-dev team.
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 2.1.2.
  </div>
  
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-7597274-13']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>